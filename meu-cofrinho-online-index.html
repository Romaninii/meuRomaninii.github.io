<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Meu Cofrinho Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="icon.png">

<style>
/* ================= BASE ================= */
* { box-sizing: border-box; }
:root {
    --bg: #f4f6f8; --card: #fff;
    --primary: #2ecc71; --warning: #f1c40f;
    --danger: #e74c3c; --info: #3498db;
    --text: #2c3e50; --muted: #7f8c8d; --border: #e0e0e0;
}
body {
    margin:0; padding:20px; font-family: system-ui,sans-serif;
    background: var(--bg); color: var(--text);
}
.container { max-width:960px; margin:auto; background:var(--card); padding:24px; border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,0.08);}
h1{text-align:center;margin:0;font-size:2em;}
h2{text-align:center;margin:4px 0 20px;font-weight:400;color:var(--muted);}

/* ================= DEP√ìSITO ================= */
.deposito-box{text-align:center;padding:18px;border-radius:12px;background:#f1f3f5;transition:background 0.3s;}
.deposito-box.ativo{background:#e8f8f1;}
input{padding:12px;width:140px;font-size:16px;border-radius:8px;border:1px solid var(--border);}
button{padding:12px 18px;font-size:15px;border-radius:8px;border:none;cursor:pointer;margin:6px;transition:0.2s;}
button:hover{opacity:0.85;}
.btn-add{background:var(--info);color:#fff;}
.btn-reset{background:var(--danger);color:#fff;}

/* ================= PROGRESSO ================= */
.progress-container{height:22px;background:#e0e0e0;border-radius:20px;overflow:hidden;margin:20px 0;}
.progress-bar{height:100%;width:0%;transition:width 0.4s;}

/* ================= TEXTO ================= */
.feedback{text-align:center;font-weight:600;margin-top:8px;}
.total{text-align:center;font-size:18px;margin-top:10px;}

/* ================= TABELA ================= */
table{width:100%;border-collapse:collapse;margin-top:24px;}
th,td{border:1px solid var(--border);padding:10px;text-align:center;}
th{background:#fafafa;}

/* ================= GR√ÅFICO ================= */
canvas{width:100%;height:340px;margin-top:32px;}
</style>
</head>
<body>
<div class="container">
<h1>Meu Cofrinho Online</h1>
<h2>Objetivo: 3.500‚Ç¨</h2>

<div id="depositoBox" class="deposito-box">
<input id="valorInput" type="number" min="20" step="1" placeholder="‚Ç¨">
<button class="btn-add" id="btnAdd">Adicionar</button>
<p>Dep√≥sito m√≠nimo: 20‚Ç¨</p>
</div>

<div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
<div id="feedback" class="feedback"></div>
<div id="totalTexto" class="total"></div>
<div style="text-align:center"><button class="btn-reset" id="btnReset">Resetar Meta</button></div>

<table>
<thead><tr><th>Data</th><th>Valor (‚Ç¨)</th></tr></thead>
<tbody id="tabela"></tbody>
</table>

<canvas id="grafico"></canvas>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

<script>
// ================= CONFIG FIREBASE =================
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_AUTH_DOMAIN",
  databaseURL: "SUA_DATABASE_URL",
  projectId: "SEU_PROJECT_ID",
  storageBucket: "SEU_STORAGE_BUCKET",
  messagingSenderId: "SEU_MESSAGING_SENDER_ID",
  appId: "SEU_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= CONFIG APP =================
const META = 3500;
const state = { depositos: [] };
const el = {
  input: document.getElementById('valorInput'),
  add: document.getElementById('btnAdd'),
  reset: document.getElementById('btnReset'),
  tabela: document.getElementById('tabela'),
  total: document.getElementById('totalTexto'),
  feedback: document.getElementById('feedback'),
  box: document.getElementById('depositoBox'),
  progress: document.getElementById('progressBar'),
  canvas: document.getElementById('grafico')
};

// ================= EVENTOS =================
el.add.onclick = adicionarDeposito;
el.reset.onclick = resetar;
window.addEventListener('resize', renderGrafico);
document.addEventListener('DOMContentLoaded', carregarDepositos);

// ================= DADOS =================
function carregarDepositos(){
  db.ref('depositos').on('value', snapshot=>{
    state.depositos = snapshot.val() || [];
    render();
  });
}

function salvarDeposito(){
  db.ref('depositos').set(state.depositos);
}

function totalAtual(){ return state.depositos.reduce((s,d)=>s+d.valor,0); }
function feedback(msg,tipo){ el.feedback.textContent=msg; el.feedback.style.color=tipo==='danger'?'var(--danger)':'var(--primary)'; }

// ================= A√á√ïES =================
function adicionarDeposito(){
  const valor=Number(el.input.value);
  if(!Number.isFinite(valor)||valor<20){ feedback('Valor m√≠nimo: 20‚Ç¨','danger'); return; }
  if(totalAtual()>=META){ feedback('Meta j√° atingida üéâ','primary'); return; }
  state.depositos.push({ data:new Date().toLocaleDateString(), valor });
  el.input.value='';
  salvarDeposito();
  feedback('Dep√≥sito adicionado com sucesso ‚úî','primary');
  render();
}

function resetar(){
  if(!confirm('Deseja apagar todos os dados?')) return;
  state.depositos=[];
  salvarDeposito();
  render();
}

// ================= RENDER =================
function render(){
  renderTabela();
  renderTotal();
  renderProgresso();
  renderGrafico();
  el.box.classList.toggle('ativo', state.depositos.length>0);
}

function renderTabela(){
  el.tabela.innerHTML='';
  state.depositos.forEach(d=>{
    el.tabela.innerHTML+=`<tr><td>${d.data}</td><td>${d.valor.toFixed(2)}</td></tr>`;
  });
}

function renderTotal(){
  el.total.textContent=`Total poupado: ‚Ç¨${totalAtual().toFixed(2)} / ‚Ç¨${META}`;
}

function renderProgresso(){
  const pct=Math.min((totalAtual()/META)*100,100);
  el.progress.style.width=pct+'%';
  el.progress.style.background=pct<30?'var(--danger)':pct<70?'var(--warning)':'var(--primary)';
}

// ================= GR√ÅFICO =================
function renderGrafico(){
  const ctx = el.canvas.getContext('2d');
  const dpr=window.devicePixelRatio||1;
  const rect=el.canvas.getBoundingClientRect();
  el.canvas.width = rect.width*dpr; el.canvas.height=rect.height*dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0); ctx.clearRect(0,0,rect.width,rect.height);
  if(!state.depositos.length) return;
  let acumulado=0;
  const valores=state.depositos.map(d=>acumulado+=d.valor);
  const padding=40; const w=rect.width-padding*2; const h=rect.height-padding*2;

  ctx.setLineDash([6,6]); ctx.strokeStyle='#999';
  ctx.beginPath(); ctx.moveTo(padding,padding); ctx.lineTo(padding+w,padding); ctx.stroke(); ctx.setLineDash([]);

  ctx.beginPath();
  valores.forEach((v,i)=>{
    const x=padding+(i/(valores.length-1||1))*w;
    const y=padding+h-(Math.min(v,META)/META)*h;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.lineTo(padding+w,padding+h); ctx.lineTo(padding,padding+h); ctx.closePath();
  ctx.fillStyle='rgba(46,204,113,0.2)'; ctx.fill();

  ctx.beginPath();
  valores.forEach((v,i)=>{
    const x=padding+(i/(valores.length-1||1))*w;
    const y=padding+h-(Math.min(v,META)/META)*h;
    i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
  });
  ctx.strokeStyle='#2ecc71'; ctx.lineWidth=3; ctx.stroke();
}
</script>
</body>
</html>
